# 第五章 聚类

## 聚类概述

### 聚类的基本概念
- **定义**：聚类是将一组物理的或抽象的对象，根据它们之间的相似程度，分为若干簇，相似的对象构成一组。
- **目的**：帮助用户理解数据集中的自然簇和结构，实现“物以类聚，人以群分”。
- **簇**：聚在一起的一群对象，这些对象彼此相似。好的聚类应满足：簇内对象距离最小（相似性高），簇间对象距离最大（相似性低）。

### 聚类算法的分类
根据算法主要思路的不同，聚类主要分为以下五类：
1. **划分方法**：通过选择初始代表点进行初始聚类，通过迭代调整结果，直到准则函数最优（如k-means）。
2. **层次方法**：将数据集分层划分，形成树型结构。分为自底向上（凝聚）和自顶向下（分裂）两种（如AGNES、DIANA）。
3. **基于密度的方法**：只要临近区域的密度超过某个阈值就继续聚类。能过滤噪声，发现任意形状的簇（如DBSCAN）。
4. **基于网格的方法**：将对象空间划分成有限个单元的网状结构，处理速度快，处理时间仅与单元数有关。
5. **基于模型的方法**：为每个簇假定一个模型（如概率分布），寻找满足该模型的数据集。

## 划分方法

### 划分方法的主要思想
- 给定包含n个对象的数据集，构建k个划分（k≤n）。
- **条件**：每个簇至少包含一个对象；每个对象属于且仅属于一个簇。
- **过程**：首先给出初始划分，然后采用迭代重定位技术，通过对象在簇间的移动来改进划分，使得同一簇内对象尽可能“接近”，不同簇间对象尽可能“远离”。
- **代表算法**：k-means（k均值）、k-medoids（k中心点）。

### k均值算法
- **核心思想**：将各个聚类子集内所有数据样本的均值作为该簇的代表点（质心），通过迭代把数据集划分为不同类别，使准则函数（误差平方和）最优。
- **适用性**：不适合处理离散型属性，对连续型属性效果较好。
- **算法步骤**：
  1. 从D中随机选择k个对象作为初始簇中心；
  2. 将每个点指派到最近的中心，形成k个簇；
  3. 重新计算每个簇的质心（均值）；
  4. 计算目标函数E；
  5. 重复步骤2-4，直到目标函数E不再变化或中心不再变化。
- **目标函数E**：误差平方和，衡量聚类质量，E值越小越好。
- **示例**：
  - 数据集：{2, 4, 10, 12, 3, 20, 30, 11, 25}，k=2。
  - 初始中心：m1=2, m2=4。
  - 第一次分配：C1={2, 3}, C2={4, 10, 12, 20, 30, 11, 25}。
  - 更新中心：m1=2.5, m2=16。
  - 迭代直至收敛，最终结果可能为 C1={2, 3, 4, 10, 11, 12}, C2={20, 30, 25}。

### k中心点算法
- **背景**：k均值对离群点敏感，极大值可能扭曲数据分布。k中心点算法试图消除这种敏感性。
- **核心思想**：在每个簇中选出一个最靠近均值的实际对象（中心点）来代表该簇。
- **目标函数**：绝对误差标准（E），即所有对象到其所属簇中心点的绝对距离之和。
- **PAM算法（Partitioning Around Medoids）**：
  1. **建立**：随机选择k个对象作为初始中心点；
  2. **交换**：反复尝试用非中心点代替中心点，计算代价S，如果S为负（误差减少），则进行交换。
  3. 重复直到中心点不再变化。
- **特点**：比k均值更健壮，计算代价较高。

## 层次方法

### 层次方法的分类
1. **凝聚层次聚类**：
   - **方向**：自底向上。
   - **过程**：初始时每个对象为一个簇，然后合并相似度最高的簇，直到所有对象合并为一个簇或满足终止条件。
   - **代表算法**：AGNES。
2. **分裂层次聚类**：
   - **方向**：自顶向下。
   - **过程**：初始时所有对象为一个簇，然后逐步分裂成更小的簇，直到每个对象自成一簇或满足终止条件。
   - **代表算法**：DIANA。

### 簇间距离度量方法
1. **最小距离**：两个簇中最近数据点的距离（单链接）。
2. **最大距离**：两个簇中最远数据点的距离（全链接）。
3. **均值距离**：两个簇中心点（质心）之间的距离。
4. **平均距离**：两个簇所有数据点距离的平均值。

### AGNES算法
- **输入**：数据集D，终止条件簇数目k。
- **步骤**：
  1. 将每个对象当成一个初始簇；
  2. 找到距离最近的两个簇（基于最小距离等度量）；
  3. 合并这两个簇；
  4. 重复直到达到定义的簇数目。
- **特点**：简单，但合并后不能撤销；复杂度O(n²)，不适合大数据集。

### DIANA算法
- **输入**：数据集D，终止条件簇数目k。
- **步骤**：
  1. 将所有对象视为一个初始簇；
  2. 在簇中找到距离最远的样本点对；
  3. 以这对点为代表，将原簇中的点重新分配到两个新簇中；
  4. 重复直到达到定义的簇数目。
- **特点**：分裂操作不可撤销；复杂度O(tn²)，不适合大数据集。

### BIRCH算法
- **全称**：Balanced Iterative Reducing and Clustering using Hierarchies。
- **特点**：利用CF树（聚类特征树）进行层次划分，旨在解决可伸缩性和不能撤销的问题。适合大数据集，只需单遍扫描。
- **聚类特征（CF）**：
  - 定义为一个三元组：CF = <n, LS, SS>。
    - n：簇中点的数目。
    - LS：n个点的线性和（$\sum x_i$）。
    - SS：n个点的平方和（$\sum x_i^2$）。
  - CF具有可加性，便于合并簇和计算簇的统计量（如质心、半径R、直径D）。
- **算法过程**：
  1. 读入新数据点，寻找最近的叶子节点（簇）。
  2. 若插入后簇直径/半径小于阈值T，则插入并更新路径上的CF；
  3. 若插入后超过阈值但有空间，则新建一个簇；
  4. 否则，分裂叶子节点。
- **优缺点**：
  - 优点：速度快，节省内存，可增量聚类，能识别噪声。
  - 缺点：对球状簇效果较好，对非球状或高维数据效果一般；CF树对节点数有限制，可能影响聚类质量。

## 5.4 基于密度的方法

### 基本概念
- **核心思想**：只要一个区域中的点的密度大于某个阈值，就将其加到相近的聚类中。
- **优点**：能克服基于距离算法只能发现“类圆形”聚类的缺点，可发现任意形状的聚类，对噪声不敏感。
- **代表算法**：DBSCAN、OPTICS、DENCLUE。

### DBSCAN算法
- **术语定义**：
  - **$\varepsilon$-邻域**：给定对象半径$\varepsilon$内的区域。
  - **核心对象**：如果对象的$\varepsilon$邻域内至少包含MinPts个对象，则称其为核心对象。
  - **边界点**：不是核心点，但落在某个核心点的$\varepsilon$邻域内。
  - **噪声**：不包含在任何簇中的对象。
  - **直接密度可达**：若p在核心对象q的$\varepsilon$邻域内，则称p从q直接密度可达。
  - **密度可达**：若存在对象链$p_1, ..., p_n$，$p_1=q, p_n=p$，且$p_{i+1}$从$p_i$直接密度可达，则称p从q密度可达。
  - **密度相连**：若对象p和q都从对象o密度可达，则称p和q密度相连。
- **算法步骤**：
  1. 遍历所有点，判断是否为核心对象；
  2. 找出核心对象$\varepsilon$邻域内的所有直接密度可达点；
  3. 从核心对象出发，合并所有密度可达的点，形成最大密度相连对象集合（即一个簇）；
  4. 处理完所有点后，未被归类的点即为噪声。

## 实战：银行客户聚类分析

### 背景与聚类目的
- **背景**：利用聚类分析细分银行客户市场，研究消费者行为。
- **数据**：`bank-data.arff`（包含客户年龄、性别、收入、是否购买股权计划PEP等属性）。
- **工具**：Weka。
- **方法**：k-means算法（Weka会自动将分类属性转换为数值，并对数据进行标准化）。

### 聚类过程
1. **数据加载**：打开Weka Explorer -> Preprocess -> Open file `bank-data.arff`。
2. **查看数据**：在Current relation和Attributes面板查看实例数、属性及分布。
3. **选择算法**：切换到Cluster标签 -> Choose -> `SimpleKMeans`。
4. **参数设置**：
   - `numClusters`：设置为6（聚成6类）。
   - `seed`：随机种子（如10），用于初始化中心。
5. **执行聚类**：选中`Use training set`和`Store clusters for visualization`，点击Start。

### 聚类结果分析
- **聚类概览**：共生成6个簇（Cluster 0-5）。
- **重点簇分析**（实例数最多的3个簇：1、4、5）：
  1. **簇1 (166例, 28%)**：
     - **特征**：未购买PEP。无抵押、无车，有储蓄和活期账户。平均收入略高于总体平均。
     - **分析**：投资谨慎，倾向储蓄。不建议强行推销，除非改变其理财观念。
  2. **簇5 (134例, 22%)**：
     - **特征**：购买了PEP。无抵押、未婚、有车、有储蓄。平均收入在所有簇中最高。
     - **分析**：经济基础好，理财观念新。应作为重点推销对象，成功率最高。
  3. **簇4 (99例, 17%)**：
     - **特征**：购买了PEP。有抵押、有车，无储蓄账户。平均收入与总体持平。
     - **分析**：有一定经济基础，消费理念新，开销大。建议有选择性地推荐。
